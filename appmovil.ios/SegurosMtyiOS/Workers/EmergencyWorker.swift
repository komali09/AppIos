//
//  EmergencyWorker.swift
//  SegurosMtyiOS
//
//  Created by Isidro Adan Garcia Solorio  on 12/27/17.
//  Copyright (c) 2017 IA Interactive. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit
import RxSwift
import SwiftyRSA

class EmergencyWorker {
    /**
     Método que realiza la petición para pedir asistencia
     */
    func emergencyPetition(_ type: TypePetition) -> Observable<EmergencyResponse>{
        return Observable.create { observable in
            let disposable = ServiceManager.emergencyPetition(type: type.hashValue).subscribe { event in
                switch event {
                case .next(let result):
                        observable.onNext(result)
                case .error(let error):
                     observable.onError(error)
                case .completed:
                    break
                }
            }
            return Disposables.create {
                disposable.dispose()
            }
        }
    }
    
    /**
     Método que realiza una llamada dependiendo donde se encuentra el usuario
     */
    func callAtPhone(assistancePhone: AssistancePhone) {
        var phone: String?
        
        switch assistancePhone {
        case .withinMexico:
            phone = "5552504116"
        case .wihtinRestOfMexico:
            phone = "018007135076"
        case .withinUSAAndCanada:
            phone = "018776394639"
        case .withinRestOfTheWorld:
            phone = "013054594880"
        }
        
        if let mobileCallUrl = URL(string: "tel://\(phone!)") {
            let application = UIApplication.shared
            
            if application.canOpenURL(mobileCallUrl) {
                application.open(mobileCallUrl, options: [:], completionHandler: nil)
            }
        }
    }
}
